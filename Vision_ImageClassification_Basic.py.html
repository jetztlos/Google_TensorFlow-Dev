<html>
<head>
<title>Vision_ImageClassification_Basic.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #8c8c8c; font-style: italic;}
.s1 { color: #080808;}
.s2 { color: #0033b3;}
.s3 { color: #067d17;}
.s4 { color: #1750eb;}
.s5 { color: #0037a6;}
</style>
</head>
<body bgcolor="#ffffff">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Vision_ImageClassification_Basic.py</font>
</center></td></tr></table>
<pre><span class="s0"># From: https://www.tensorflow.org/tutorials/keras/classification</span>
<span class="s0">## Setup</span>
<span class="s0"># TensorFlow and tf.keras</span>
<span class="s2">import </span><span class="s1">tensorflow </span><span class="s2">as </span><span class="s1">tf</span>

<span class="s0"># Helper libraries</span>
<span class="s2">import </span><span class="s1">numpy </span><span class="s2">as </span><span class="s1">np</span>
<span class="s2">import </span><span class="s1">matplotlib.pyplot </span><span class="s2">as </span><span class="s1">plt</span>

<span class="s1">print(tf.__version__)</span>

<span class="s0">## Import the Fashion MNIST dataset</span>
<span class="s1">fashion_mnist = tf.keras.datasets.fashion_mnist</span>

<span class="s1">(train_images, train_labels), (test_images, test_labels) = fashion_mnist.load_data()</span>

<span class="s1">class_names = [</span><span class="s3">'T-shirt/top'</span><span class="s1">, </span><span class="s3">'Trouser'</span><span class="s1">, </span><span class="s3">'Pullover'</span><span class="s1">, </span><span class="s3">'Dress'</span><span class="s1">, </span><span class="s3">'Coat'</span><span class="s1">,</span>
               <span class="s3">'Sandal'</span><span class="s1">, </span><span class="s3">'Shirt'</span><span class="s1">, </span><span class="s3">'Sneaker'</span><span class="s1">, </span><span class="s3">'Bag'</span><span class="s1">, </span><span class="s3">'Ankle boot'</span><span class="s1">]</span>

<span class="s0">## Explore the data</span>
<span class="s1">train_images.shape</span>

<span class="s1">len(train_labels)</span>

<span class="s1">train_labels</span>

<span class="s1">test_images.shape</span>

<span class="s1">len(test_labels)</span>

<span class="s0">## Preprocess the data</span>
<span class="s1">plt.figure()</span>
<span class="s1">plt.imshow(train_images[</span><span class="s4">0</span><span class="s1">])</span>
<span class="s1">plt.colorbar()</span>
<span class="s1">plt.grid(</span><span class="s2">False</span><span class="s1">)</span>
<span class="s1">plt.show()</span>

<span class="s1">train_images = train_images / </span><span class="s4">255.</span>
<span class="s1">test_images = test_images / </span><span class="s4">255.</span>

<span class="s1">plt.figure(figsize=(</span><span class="s4">10</span><span class="s1">,</span><span class="s4">10</span><span class="s1">))</span>
<span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(</span><span class="s4">25</span><span class="s1">):</span>
    <span class="s1">plt.subplot(</span><span class="s4">5</span><span class="s1">,</span><span class="s4">5</span><span class="s1">,i+</span><span class="s4">1</span><span class="s1">)</span>
    <span class="s1">plt.xticks([])</span>
    <span class="s1">plt.yticks([])</span>
    <span class="s1">plt.grid(</span><span class="s2">False</span><span class="s1">)</span>
    <span class="s1">plt.imshow(train_images[i], cmap=plt.cm.binary)</span>
    <span class="s1">plt.xlabel(class_names[train_labels[i]])</span>
<span class="s1">plt.show()</span>

<span class="s0">## Build the model</span>
<span class="s0">### Set up the layers</span>
<span class="s1">model = tf.keras.Sequential([</span>
    <span class="s1">tf.keras.layers.Flatten(input_shape=(</span><span class="s4">28</span><span class="s1">, </span><span class="s4">28</span><span class="s1">)),</span>
    <span class="s1">tf.keras.layers.Dense(</span><span class="s4">128</span><span class="s1">, activation=</span><span class="s3">'relu'</span><span class="s1">),</span>
    <span class="s1">tf.keras.layers.Dense(</span><span class="s4">10</span><span class="s1">)</span>
<span class="s1">])</span>

<span class="s0">### Compile the model</span>
<span class="s1">model.compile(loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=</span><span class="s2">True</span><span class="s1">),</span>
              <span class="s1">optimizer=</span><span class="s3">'adam'</span><span class="s1">,</span>
              <span class="s1">metrics=[</span><span class="s3">'accuracy'</span><span class="s1">])</span>

<span class="s0">## Train the model</span>
<span class="s0">### Feed the model</span>
<span class="s1">model.fit(train_images, train_labels,</span>
          <span class="s1">epochs=</span><span class="s4">10</span><span class="s1">)</span>

<span class="s0">### Evaluate accuracy</span>
<span class="s1">test_loss, test_acc = model.evaluate(test_images, test_labels,</span>
                                     <span class="s1">verbose=</span><span class="s4">2</span><span class="s1">)</span>
<span class="s1">print(</span><span class="s3">'</span><span class="s5">\n</span><span class="s3">Test accuracy:'</span><span class="s1">, test_acc)</span>

<span class="s0">### Make predictions</span>
<span class="s1">probability_model = tf.keras.Sequential([</span>
    <span class="s1">model,</span>
    <span class="s1">tf.keras.layers.Softmax()</span>
<span class="s1">])</span>
<span class="s1">predictions = probability_model.predict(test_images)</span>

<span class="s1">predictions[</span><span class="s4">0</span><span class="s1">]</span>

<span class="s1">np.argmax(predictions[</span><span class="s4">0</span><span class="s1">])</span>

<span class="s1">test_labels[</span><span class="s4">0</span><span class="s1">]</span>

<span class="s2">def </span><span class="s1">plot_image(i, predictions_array, true_label, img):</span>
  <span class="s1">true_label, img = true_label[i], img[i]</span>
  <span class="s1">plt.grid(</span><span class="s2">False</span><span class="s1">)</span>
  <span class="s1">plt.xticks([])</span>
  <span class="s1">plt.yticks([])</span>

  <span class="s1">plt.imshow(img, cmap=plt.cm.binary)</span>

  <span class="s1">predicted_label = np.argmax(predictions_array)</span>
  <span class="s2">if </span><span class="s1">predicted_label == true_label:</span>
    <span class="s1">color = </span><span class="s3">'blue'</span>
  <span class="s2">else</span><span class="s1">:</span>
    <span class="s1">color = </span><span class="s3">'red'</span>

  <span class="s1">plt.xlabel(</span><span class="s3">&quot;{} {:2.0f}% ({})&quot;</span><span class="s1">.format(class_names[predicted_label],</span>
                                <span class="s4">100</span><span class="s1">*np.max(predictions_array),</span>
                                <span class="s1">class_names[true_label]),</span>
                                <span class="s1">color=color)</span>

<span class="s2">def </span><span class="s1">plot_value_array(i, predictions_array, true_label):</span>
    <span class="s1">true_label = true_label[i]</span>
    <span class="s1">plt.grid(</span><span class="s2">False</span><span class="s1">)</span>
    <span class="s1">plt.xticks(range(</span><span class="s4">10</span><span class="s1">))</span>
    <span class="s1">plt.yticks([])</span>
    <span class="s1">thisplot = plt.bar(range(</span><span class="s4">10</span><span class="s1">), predictions_array, color=</span><span class="s3">&quot;#777777&quot;</span><span class="s1">)</span>
    <span class="s1">plt.ylim([</span><span class="s4">0</span><span class="s1">, </span><span class="s4">1</span><span class="s1">])</span>
    <span class="s1">predicted_label = np.argmax(predictions_array)</span>

    <span class="s1">thisplot[predicted_label].set_color(</span><span class="s3">'red'</span><span class="s1">)</span>
    <span class="s1">thisplot[true_label].set_color(</span><span class="s3">'blue'</span><span class="s1">)</span>

<span class="s0">### Verify predictions</span>
<span class="s1">i = </span><span class="s4">0</span>
<span class="s1">plt.figure(figsize=(</span><span class="s4">6</span><span class="s1">,</span><span class="s4">3</span><span class="s1">))</span>
<span class="s1">plt.subplot(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">2</span><span class="s1">,</span><span class="s4">1</span><span class="s1">)</span>
<span class="s1">plot_image(i, predictions[i], test_labels, test_images)</span>
<span class="s1">plt.subplot(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">2</span><span class="s1">,</span><span class="s4">2</span><span class="s1">)</span>
<span class="s1">plot_value_array(i, predictions[i],  test_labels)</span>
<span class="s1">plt.show()</span>

<span class="s1">i = </span><span class="s4">12</span>
<span class="s1">plt.figure(figsize=(</span><span class="s4">6</span><span class="s1">,</span><span class="s4">3</span><span class="s1">))</span>
<span class="s1">plt.subplot(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">2</span><span class="s1">,</span><span class="s4">1</span><span class="s1">)</span>
<span class="s1">plot_image(i, predictions[i], test_labels, test_images)</span>
<span class="s1">plt.subplot(</span><span class="s4">1</span><span class="s1">,</span><span class="s4">2</span><span class="s1">,</span><span class="s4">2</span><span class="s1">)</span>
<span class="s1">plot_value_array(i, predictions[i],  test_labels)</span>
<span class="s1">plt.show()</span>

<span class="s0"># Plot the first X test images, their predicted labels, and the true labels.</span>
<span class="s0"># Color correct predictions in blue and incorrect predictions in red.</span>
<span class="s1">num_rows = </span><span class="s4">5</span>
<span class="s1">num_cols = </span><span class="s4">3</span>
<span class="s1">num_images = num_rows*num_cols</span>
<span class="s1">plt.figure(figsize=(</span><span class="s4">2</span><span class="s1">*</span><span class="s4">2</span><span class="s1">*num_cols, </span><span class="s4">2</span><span class="s1">*num_rows))</span>
<span class="s2">for </span><span class="s1">i </span><span class="s2">in </span><span class="s1">range(num_images):</span>
  <span class="s1">plt.subplot(num_rows, </span><span class="s4">2</span><span class="s1">*num_cols, </span><span class="s4">2</span><span class="s1">*i+</span><span class="s4">1</span><span class="s1">)</span>
  <span class="s1">plot_image(i, predictions[i], test_labels, test_images)</span>
  <span class="s1">plt.subplot(num_rows, </span><span class="s4">2</span><span class="s1">*num_cols, </span><span class="s4">2</span><span class="s1">*i+</span><span class="s4">2</span><span class="s1">)</span>
  <span class="s1">plot_value_array(i, predictions[i], test_labels)</span>
<span class="s1">plt.tight_layout()</span>
<span class="s1">plt.show()</span>

<span class="s0">## Use the trained model</span>
<span class="s0"># Grab an image from the test dataset.</span>
<span class="s1">img = test_images[</span><span class="s4">1</span><span class="s1">]</span>

<span class="s1">print(img.shape)</span>

<span class="s0"># Add the image to a batch where it's the only member.</span>
<span class="s1">img = (np.expand_dims(img,</span><span class="s4">0</span><span class="s1">))</span>

<span class="s1">print(img.shape)</span>

<span class="s0"># Now predict the correct label for this image</span>
<span class="s1">predictions_single = probability_model.predict(img)</span>

<span class="s1">print(predictions_single)</span>

<span class="s1">plot_value_array(</span><span class="s4">1</span><span class="s1">, predictions_single[</span><span class="s4">0</span><span class="s1">], test_labels)</span>
<span class="s1">_ = plt.xticks(range(</span><span class="s4">10</span><span class="s1">), class_names, rotation=</span><span class="s4">45</span><span class="s1">)</span>
<span class="s1">plt.show()</span>

<span class="s1">np.argmax(predictions_single[</span><span class="s4">0</span><span class="s1">])</span>
</pre>
</body>
</html>